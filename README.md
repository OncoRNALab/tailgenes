This repository contains data and scripts used to generate numbers and figures for the paper by Morlion et al.: *"Patient-specific alterations in blood plasma cfRNA profiles enable accurate classification of cancer patients and controls"* currently on [medRxiv](https://doi.org/10.1101/2023.05.24.23290388)

## System Requirements
### Software
R ≥ 4.2.1 (tested: 4.2.1 and 4.4.0)  
RStudio (optional, tested: 2024.09+)

### R packages
The following R package versions were used in the manuscript:  
biomarRt v2.62.0; caret v6.0.94; data.table v1.16.4; DESeq2 v1.36.0; EnhancedVolcano v1.24.0; fgsea v1.22.0; GeneOverlap v1.32.0; ggpubr v0.6.0; ggrepel v0.9.6; gridExtra v2.3; here v1.0.1; pheatmap v1.0.12; pROC v1.18.0; rstatix v0.7.2; tidyverse v1.3.2.

### Operating system
Supported: Any system running R ≥ 4.2.1  
Tested on: Linux (RHEL 9.6) and macOS  
Expected to work: Windows 10/11 (not tested)  

### Hardware
No non-standard hardware required  
Recommended: 8 GB RAM (16 GB+ for large custom datasets)

## Installation
### Clone the repository:
  ```bash
  git clone https://github.com/OncoRNALab/tailgenes.git
  cd tailgenes
  ```
Typical time: ~10-20 seconds on a standard desktop machine.

### Install the required R packages
  ```r
  if (!require("BiocManager", quietly = TRUE))
  install.packages("BiocManager")

  pkgs <- c("biomarRt","caret","data.table","DESeq2","EnhancedVolcano","fgsea",
          "GeneOverlap","ggpubr","ggrepel","gridExtra","here","pheatmap",
          "pROC","rstatix","tidyverse")
  BiocManager::install(pkgs)
  ```
Fresh install: 5–15 minutes
If most packages are already installed: <2 minutes

## Analyses
The `data_analysis` folder contains scripts to run differential abundance and tail gene analyses.  
The scripts can be run in R (≥4.2.1) and RStudio, on any operating system and - depending on the input data - require several minutes to a few hours. 

### Running the .Rmd files in RStudio (recommended)
1. Open the .Rmd file in RStudio
2. Click Knit (or run all code chunks manually)

RStudio includes its own Pandoc, so no extra installation is required.

### Repository Structure and Contents
```
tailgenes/
│
├── data_analysis/        # R scripts for analyses
├── input/                # Raw counts + annotation
├── data/                 # Output tables generated by scripts
├── figures/              # Plots generated by scripts
└── README.md             # Documentation
```

The `input` folder contains annotation and count data, used as input for scripts in the `data_analysis` folder:
- *SupplTable1_sample_annotation.txt*: pan-cancer, three-cancer, prostate cancer, non-malignant and lymphoma cohort sample annotation (plasma samples)
- *bladdercancer_sample_annotation.txt*: bladder cancer cohort sample annotation (urine samples)
- *\*_counts.txt*: raw counts (STAR+HTseq) for the respective sample cohort

The `data` folder contains files that are made using the scripts in the `data_analysis` folder:
- Differential abundance & GSEA files (generated by `differentialabundance.R` script):
  - folder *pancancer_GSEA* & *threecancer_GSEA* contain the fold change ranked gene lists per cancer vs control comparison in the respective cohorts - used as input for gene set enrichment analyses
  - *differentialabundance_\*.txt*: tables with differentially abundant genes (|log2(fold change)|>1 and adjusted p>0.05) per cancer-control comparison (cancertype) in the respective cohort \*
  - *\*_normcounts(_all).txt*: DESeq2 library size normalized counts for the respective sample cohort
    - for the prostate cancer cohort, only a file with normalized counts rounded to 9 digits was uploaded (*prostatecancer_normcounts_rounded.txt*) due to size restrictions
- Tail gene analyses (generated by `tailgenes_*.R` scripts):
  - *\*_biomarkertail_list.txt*: list of biomarker tail genes per set for cohort \*
  - *\*_tailgenes.txt*: list of tail genes per sample of cohort \* with respective z-score (based on all controls except sample itself) and normalized counts
  - overview_tailgenes.txt: table containing all tail genes with the number of samples for which they are tail gene, direction, and identify as biomarker tail gene

The `figures` folder contains plots that are made using the scripts in the `data_analysis` folder:
- *\*diffabundance_\*.pdf*: figures generated by `differentialabundance.Rmd` script
- *\*_PCA.pdf*: PCA figures generated by `differentialabundance.Rmd` script
- *threecancer_(biomarker)tail_\*.pdf* / *threecancer_(biomarker)tail_\*.png*: figures generated by `tailgenes_threecancer.Rmd` script of respective cohort
- *prostatecancer_(biomarker)tail_\*.pdf* / *prostatecancer_(biomarker)tail_\*.png*: figures generated by `tailgenes_prostatecancer.Rmd` script of respective cohort
- *lymphoma_(biomarker)tail_\*.pdf* / *lymphoma_(biomarker)tail_\*.png*: figures generated by `tailgenes_lymphoma.Rmd` script of respective cohort
- *bladdercancer_(biomarker)tail_\*.pdf* / *bladdercancer_(biomarker)tail_\*.png*: figures generated by `tailgenes_bladdercancer.Rmd` script of respective cohort
